(window["webpackJsonpno-pc-qr"]=window["webpackJsonpno-pc-qr"]||[]).push([[0],{149:function(e,t,r){e.exports=r(246)},245:function(e,t,r){},246:function(e,t,r){"use strict";r.r(t);r(150),r(176),r(178),r(179),r(181),r(182),r(183),r(184),r(185),r(186),r(187),r(188),r(190),r(191),r(192),r(193),r(194),r(195),r(196),r(197),r(198),r(199),r(201),r(202),r(203),r(204),r(205),r(206),r(207),r(208),r(209),r(210),r(211),r(212),r(213),r(214),r(215),r(216),r(217),r(218);var a=r(0),o=r.n(a),n=r(28),s=r.n(n),c=r(27),l=r.n(c),i=r(82),p=r(43),m=r(38),g=r(88),u=r(83),d=r(89),h=r(58),f=r(18),S=r(84),v=r.n(S),y=r(59),w=r.n(y),C=(r(243),r(85)),I=r.n(C),E=r(86),P=r.n(E),b=r(87),Y=r.n(b);r(244),r(245);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O=function(e){function t(e){var r;return Object(p.a)(this,t),(r=Object(g.a)(this,Object(u.a)(t).call(this,e))).changeSelectedPhoto=function(e){var t=e.target;if(r.removeStopScrollWindow(),r.setState(W({},r.state,{},r.defaultState)),t&&t.files&&t.files[0]){var a=new FileReader;a.onload=function(e){r.setImage(e.target.result)},a.onerror=function(){console.error("\u0424\u0430\u0439\u043b \u043d\u0435 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d!")},a.readAsDataURL(t.files[0])}},r.move=function(e,t,a){var o=r.state.currentPosCroppedX+e.shiftX,n=r.state.currentPosCroppedY+e.shiftY;o<0&&(o=0),n<0&&(n=0);var s=document.getElementById("opacity-image");s&&n+r.state.currentHeightCropper>s.offsetHeight&&(n=s.offsetHeight-r.state.currentHeightCropper),s&&o+r.state.currentWidthCropper>s.offsetWidth&&(o=s.offsetWidth-r.state.currentWidthCropper),r.currentPosCroppedX=o,r.currentPosCroppedY=n,r.setState({croppedImageStyles:W({},r.state.croppedImageStyles,{transform:"translateX(".concat(o,"px) translateY(").concat(n,"px)")}),croppedImageOverflowSyles:W({},r.state.croppedImageOverflowSyles,{transform:"translateX(".concat(-o+r.state.currentPosImageX,"px) translateY(").concat(-n+r.state.currentPosImageY,"px)")})})},r.stopScrollWindow=function(){console.log("Stopping scroll.."),console.log(window.scrollY),r.lastScrollPos=window.scrollY,r.setState({wrapCropperStyles:W({},r.state.wrapCropperStyles,{overflow:"hidden",transform:"translateY(-".concat(window.scrollY,"px)")})}),document.body.classList.add("no-overflow"),document.getElementsByTagName("html")[0].classList.add("no-overflow")},r.removeStopScrollWindow=function(){document.body.classList.remove("no-overflow"),document.getElementsByTagName("html")[0].classList.remove("no-overflow"),window.scrollTo(0,r.lastScrollPos),r.setState({wrapCropperStyles:W({},r.state.wrapCropperStyles,{overflow:"auto",transform:"none"})})},r.onEndCrop=function(){r.setState({currentPosCroppedX:r.currentPosCroppedX,currentPosCroppedY:r.currentPosCroppedY}),r.removeStopScrollWindow()},r.moveImage=function(e){var t=r.state.currentPosImageX+e.shiftX,a=r.state.currentPosImageY+e.shiftY;r.currentPosImageX=t,r.currentPosImageY=a,r.setState({imageStyles:W({},r.state.imageStyles,{transform:"translateX(".concat(t,"px) translateY(").concat(a,"px)")}),croppedImageOverflowSyles:W({},r.state.croppedImageOverflowSyles,{transform:"translateX(".concat(t-r.state.currentPosCroppedX,"px) translateY(").concat(a-r.state.currentPosCroppedY,"px)")})})},r.onEndImageMove=function(){r.setState({currentPosImageX:r.currentPosImageX,currentPosImageY:r.currentPosImageY})},r.scaleImagesMove=function(e){var t=e.originalEvent.target,a=!!t.classList.value.match("right"),o=(t.classList.value.match("left"),r.state.currentWidthCropper+(a?e.shiftX:-e.shiftX)),n=r.state.currentHeightCropper+(a?e.shiftY:-e.shiftY);o<n?n=o:o=n,r.currentWidthCropper=o,r.currentHeightCropper=n,r.setState({cropperImageStyles:W({},r.state.cropperStyles,{width:o,height:n}),croppedImageStyles:W({},r.state.croppedImageStyles,{width:o,height:n})})},r.onEndScaleImagesMove=function(e){r.setState({currentWidthCropper:r.currentWidthCropper,currentHeightCropper:r.currentHeightCropper}),r.removeStopScrollWindow()},r.getQrFromCrop=function(){var e=document.getElementById("opacity-image"),t=(document.getElementById("crop").getBoundingClientRect(),r.state.currentPosCroppedX),a=r.state.currentPosCroppedY,o=Math.floor(t*r.state.imageWidth/e.offsetWidth),n=Math.floor(a*r.state.imageHeight/e.offsetHeight),s=Math.floor(r.state.currentHeightCropper*r.state.imageHeight/e.offsetHeight),c=Math.floor(r.state.currentWidthCropper*r.state.imageWidth/e.offsetWidth),l=document.createElement("canvas");l.width=r.state.imageWidth,l.height=r.state.imageHeight;var i=l.getContext("2d"),p=new Image;p.onload=function(){i.drawImage(p,0,0);var e=i.getImageData(o,n,c,s);l.height=s,l.width=c,i.clearRect(0,0,l.width,l.height),i.putImageData(e,0,0),(p=new Image).onload=function(){r.getQRFromImage(p)},p.src=l.toDataURL()},p.src=r.state.image},r.setQrResult=function(e){r.setState({qrResult:e})},r.openThisImage=function(){l.a.send("VKWebAppShowImages",{images:[r.state.image]})},r.defaultState={image:"",cropperStyles:{},croppedImageStyles:{},cropperImageStyles:{},croppedImageOverflowSyles:{},currentPosCroppedX:0,currentPosCroppedY:0,currentPosImageX:0,currentPosImageY:0,currentHeightCropper:100,currentWidthCropper:100,wrapCropperStyles:{},wrapCropperContentStyles:{},qrResult:""},r.state=W({},r.defaultState,{aciveSnack:null}),r.currentCroppedX=r.state.currentPosCroppedX,r.currentCroppedY=r.state.currentCroppedY,r.currentPosImageX=r.state.currentPosImageX,r.currentPosImageY=r.state.currentPosImageY,r.currentHeightCropper=r.state.currentHeightCropper,r.currentWidthCropper=r.state.currentWidthCropper,r.lastScrollPos=0,r.snacks={qrDecodedSuccessfull:r.qrDecodedSnack(),qrDecodedError:r.qrDecodedSnack(!1)},h.a.WORKER_PATH="libs/qr-scanner/qr-scanner-worker.min.js",r}return Object(d.a)(t,e),Object(m.a)(t,[{key:"setImage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],new Image);r.src=t,r.onload=function(){var a=r.height*window.innerWidth/r.width,o=window.innerWidth/2-e.defaultState.currentWidthCropper/2,n=a/2-e.defaultState.currentHeightCropper/2;e.setState({image:t,imageWidth:r.width,imageHeight:r.height,currentPosCroppedX:o,currentPosCroppedY:n,croppedImageStyles:{transform:"translateX(".concat(o,"px) translateY(").concat(n,"px)")},croppedImageOverflowSyles:{transform:"translateX(".concat(-o,"px) translateY(").concat(-n,"px)")}})}}},{key:"seActiveSnack",value:function(e){this.setState({aciveSnack:e})}},{key:"qrDecodedSnack",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return o.a.createElement(f.g,{onClose:function(){return e.seActiveSnack(null)},before:t?o.a.createElement(P.a,{fill:"#16C60C"}):o.a.createElement(Y.a,{fill:"#F44336"})},t?"\u0414\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b":"QR \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d")}},{key:"componentDidUpdate",value:function(){if(this.state.image){var e=document.getElementById("opacity-image");e&&this.state.cropperStyles.height!==e.offsetHeight&&this.setState({cropperStyles:W({},this.state.cropperStyles,{height:e.height})})}}},{key:"getQRFromImage",value:function(e){var t=this;h.a.scanImage(e).then((function(e){t.setQrResult(e),t.seActiveSnack(t.snacks.qrDecodedSuccessfull)})).catch((function(e){t.setQrResult(""),t.seActiveSnack(t.snacks.qrDecodedError)}))}},{key:"render",value:function(){var e=this;return o.a.createElement(f.i,{activePanel:"main"},o.a.createElement(f.e,{id:"main",theme:"white",className:!this.state.image&&"centering-panel"},o.a.createElement(f.f,null,"QR \u0431\u0435\u0437 \u043a\u0430\u043c\u0435\u0440\u044b"),this.state.image&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"wrap-cropper",style:this.state.wrapCropperStyles},o.a.createElement("div",{className:"wrap-cropper-content",style:this.state.wrapCropperContentStyles},o.a.createElement("div",{className:"cropper",style:this.state.cropperStyles},o.a.createElement("div",{className:"crop",id:"crop",style:this.state.croppedImageStyles},["bottom-right"].map((function(t){return o.a.createElement(f.h,{onStart:e.stopScrollWindow,onMove:e.scaleImagesMove,onEnd:e.onEndScaleImagesMove},o.a.createElement("div",{className:"crop-controller "+t}))})),o.a.createElement(f.h,{onStart:this.stopScrollWindow,onMove:this.move,onEnd:this.onEndCrop},o.a.createElement("div",{className:"cropped-image",style:this.state.cropperImageStyles,onTouchStart:this.startTouch},o.a.createElement("img",{style:this.state.croppedImageOverflowSyles,src:this.state.image})))),o.a.createElement("div",{className:"opacity-image",onClick:this.openThisImage},o.a.createElement("img",{id:"opacity-image",style:this.state.imageStyles,src:this.state.image}))),o.a.createElement(f.b,null,this.state.qrResult&&o.a.createElement("div",{style:{wordBreak:"break-all",marginTop:8,marginBottom:24}},o.a.createElement(v.a,{componentDecorator:function(e,t,r){return o.a.createElement(f.d,{href:e,key:r,target:"_blank",rel:"noopener noreferrer"},t)}},this.state.qrResult.split("\n").map((function(t){return o.a.createElement("span",null,o.a.createElement("span",null,e.state.qrResult),o.a.createElement("br",null))})))),!this.state.qrResult&&o.a.createElement("div",{style:{wordBreak:"break-all",marginTop:8,marginBottom:24}},"\u0423\u0442\u043e\u0447\u043d\u0438\u0442\u0435 \u043e\u0431\u043b\u0430\u0441\u0442\u044c QR \u043a\u043e\u0434\u0430"),o.a.createElement(f.a,{onClick:this.getQrFromCrop,before:o.a.createElement(I.a,null),size:"xl",style:{marginBottom:8}},"\u0421\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c"),o.a.createElement(f.c,{accept:"image/x-png,image/jpeg",onChange:this.changeSelectedPhoto,before:o.a.createElement(w.a,null),size:"xl",level:"secondary"},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"))))),!this.state.image&&o.a.createElement(f.b,null,o.a.createElement("p",null,"\u0427\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c QR \u0431\u0435\u0437 \u043a\u0430\u043c\u0435\u0440\u044b, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043a\u0440\u0438\u043d\u0448\u043e\u0442, \u0433\u0434\u0435 \u043e\u043d \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d"),o.a.createElement(f.c,{accept:"image/x-png,image/jpeg",onChange:this.changeSelectedPhoto,before:o.a.createElement(w.a,null),size:"l"},"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u043a\u0440\u0438\u043d\u0448\u043e\u0442")),this.state.aciveSnack))}}]),t}(o.a.Component);l.a.send("VKWebAppInit"),s.a.render(o.a.createElement(O,null),document.getElementById("root"))}},[[149,1,2]]]);
//# sourceMappingURL=main.783a90b4.chunk.js.map